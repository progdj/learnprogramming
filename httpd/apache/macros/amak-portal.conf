<Macro amak-portal $domain $licenseholderId $licenseholderChildId $alias>
    # portal vhost
    <VirtualHost *:80>
      ServerName $domain
      ServerAlias $alias
      ServerAdmin team@vrsmedia.de

      SetEnv LICENSEHOLDER $licenseholderId
      SetEnv LICENSEHOLDER_CHILD $licenseholderChildId
      PassEnv ENVIRONMENT

      DocumentRoot /var/www/amak-portal

      <Directory /var/www/amak-portal>
        Options FollowSymLinks
        AllowOverride None
        Require all granted

        RewriteEngine on
        RewriteCond %{REQUEST_FILENAME} -s [OR]
        RewriteCond %{REQUEST_FILENAME} -l [OR]
        RewriteCond %{REQUEST_FILENAME} -d

        RewriteRule ^.*$ - [NC,L]
        RewriteRule ^.*$ index.php [NC,L]

        php_admin_value error_log /var/www/amak-portal/protected/runtime/php-error.log
        php_admin_flag display_errors off

        # no access to yiic, yiic.php build.xml or any properties files here
        <FilesMatch "(yiic|yiic.php|build.xml|\.properties)$">
          Require all denied
        </FilesMatch>
      </Directory>

      <Directory /var/www/amak-portal/protected>
        Require all denied
      </Directory>

      <Directory /var/www/amak-portal/themes>
        Require all denied
      </Directory>

      <Directory /var/www/amak-portal/vendor>
        Require all denied
      </Directory>

      # CDN
      Alias /static/ /var/www/amak-portal/vendor/vrsmedia/amak-source/www/
      <Directory /var/www/amak-portal/vendor/vrsmedia/amak-source/www/>
        AllowOverride None
        Require all granted
        use amak-caching
      </Directory>


      # Prefer php files
      DirectoryIndex index.php index.html

      # Never Serve dot-files
      <FilesMatch "^\.">
        Require all denied
      </FilesMatch>

      # Logging
      ErrorLog ${APACHE_LOG_DIR}/amak-portal-$licenseholderId-error.log
      CustomLog ${APACHE_LOG_DIR}/amak-portal-$licenseholderId-access.log combined
    </VirtualHost>
</Macro>